<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HawkerHub - Stall Management</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
    />
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyBazksxHfRgOJcraIVqslvCWqZT4qjTWZE",
    authDomain: "hawkerhub-b4a7a.firebaseapp.com",
    projectId: "hawkerhub-b4a7a",
    storageBucket: "hawkerhub-b4a7a.firebasestorage.app",
    messagingSenderId: "43569063246",
    appId: "1:43569063246:web:9d18d5107d2081784e2a1f"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  </script>

    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
      <div class="container">
        <a class="navbar-brand text-danger fw-bold" href="index.html">
          <i class="bi bi-shop-window me-2"></i>HawkerHub
        </a>
        <div class="d-flex align-items-center">
          <a href="vendor-dashboard.html" class="btn btn-outline-danger me-3">
            <i class="bi bi-arrow-left me-2"></i>Back to Dashboard
          </a>
        </div>
      </div>
    </nav>

    <div class="container mt-5">
      <h1 class="mb-4 text-danger" id="stallTitle">Stall Management</h1>

      <div class="card mb-4">
        <div class="card-header bg-danger text-white">
          <h5 class="mb-0">Stall Information</h5>
        </div>
        <div class="card-body">
          <form id="stallForm">
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">Stall Name *</label>
                <input type="text" class="form-control" id="stallName" required />
              </div>
              <div class="col-md-6">
                <label class="form-label">Hawker Center *</label>
                <input type="text" class="form-control" id="hawkerCenter" required />
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">Cuisine Type *</label>
                <input type="text" class="form-control" id="cuisineType" required />
              </div>
              <div class="col-md-6">
                <label class="form-label">Operating Hours *</label>
                <input type="text" class="form-control" id="operatingHours" required />
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">Stall Description</label>
              <textarea class="form-control" id="stallDescription" rows="3"></textarea>
            </div>
            <div class="d-grid">
              <button type="submit" class="btn btn-danger">Update Stall Info</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Payment History -->
      <div class="card mb-4">
        <div class="card-header bg-danger text-white">
          <h5 class="mb-0">Payment History</h5>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table" id="paymentHistoryTable">
              <thead>
                <tr>
                  <th>Month</th>
                  <th>Amount</th>
                  <th>Payment Date</th>
                  <th>Method</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <!-- Payments populated by JS -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Upcoming Payment -->
      <div class="card">
        <div class="card-header bg-danger text-white">
          <h5 class="mb-0">Upcoming Payment</h5>
        </div>
        <div class="card-body">
          <div class="alert alert-info" id="upcomingPayment">
            <!-- Populated by JS -->
          </div>
        </div>
      </div>
    </div>

    <footer class="bg-dark text-white py-4 mt-5">
      <div class="container text-center">
        <p>&copy; 2024 HawkerHub. All rights reserved.</p>
      </div>
    </footer>

    <script type="module">
      import { doc, getDoc, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

      window.onload = async function() {
        const user = JSON.parse(localStorage.getItem("hawkerhub_user"));
        if (!user || user.role !== "vendor") window.location.href = "login.html";

        const params = new URLSearchParams(window.location.search);
        const stallId = params.get("stallId");
        if (!stallId) {
          alert("No stall selected.");
          window.location.href = "rental-agreements.html";
          return;
        }

        const stallSnap = await getDoc(doc(db, "stalls", stallId));
        if (stallSnap.exists()) {
          const data = stallSnap.data();
          document.getElementById("stallName").value = data.stallName;
          document.getElementById("hawkerCenter").value = data.hawkerCenter;
          document.getElementById("cuisineType").value = data.cuisineType;
          document.getElementById("operatingHours").value = data.operatingHours;
          document.getElementById("stallTitle").innerText = `${data.stallName} - Stall Management`;
        }

        // Load payments
        const paymentsQuery = query(collection(db, "payments"), where("stallId", "==", stallId));
        const paymentSnap = await getDocs(paymentsQuery);
        const tbody = document.querySelector("#paymentHistoryTable tbody");
        let upcomingHtml = "";
        paymentSnap.forEach(doc => {
          const p = doc.data();
          const statusBadge = p.status === "paid" ? "bg-success" : "bg-warning";
          tbody.innerHTML += `
            <tr>
              <td>${p.month}</td>
              <td>$${p.amount}</td>
              <td>${p.paymentDate}</td>
              <td>${p.method}</td>
              <td><span class="badge ${statusBadge}">${p.status}</span></td>
            </tr>
          `;
          if (p.status !== "paid") {
            upcomingHtml = `<h5><i class="bi bi-calendar-check me-2"></i>Next Payment Due</h5>
                            <p><strong>Amount:</strong> $${p.amount}</p>
                            <p><strong>Due Date:</strong> ${p.paymentDate}</p>`;
          }
        });
        document.getElementById("upcomingPayment").innerHTML = upcomingHtml || "<p>No upcoming payments.</p>";
      };
    </script>
  </body>
</html>