<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HawkerHub - Feedback</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
    />
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <nav class="navbar navbar-light bg-white shadow-sm">
      <div class="container">
        <a class="navbar-brand text-danger fw-bold" href="index.html">
          <i class="bi bi-shop-window me-2"></i>HawkerHub
        </a>
        <a href="hawker-directory.html" class="btn btn-outline-danger">
          <i class="bi bi-map me-2"></i>Browse Hawkers
        </a>
      </div>
    </nav>

    <div class="container mt-5">
      <h1 class="mb-4 text-danger">Customer Feedback</h1>

      <!-- Submit Feedback -->
      <div class="card mb-5">
        <div class="card-header bg-danger text-white">
          <h5 class="mb-0">Submit Feedback</h5>
        </div>
        <div class="card-body">
          <form id="feedbackForm">
            <div class="mb-3">
              <label class="form-label">Select Hawker *</label>
              <select class="form-select" id="hawkerSelect" required>
                <option value="">Choose a hawker...</option>
                <option>Tian Tian Chicken Rice</option>
                <option>Hill Street Fried Kway Teow</option>
                <option>Sungei Road Laksa</option>
                <option>Roti Prata House</option>
                <option>ABC Noodles</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">Rating *</label>
              <div class="rating-stars mb-2">
                <span class="star" data-value="1">☆</span>
                <span class="star" data-value="2">☆</span>
                <span class="star" data-value="3">☆</span>
                <span class="star" data-value="4">☆</span>
                <span class="star" data-value="5">☆</span>
                <input type="hidden" id="ratingValue" value="0" required />
              </div>
              <small class="text-muted"
                >Click stars to rate (1 = Poor, 5 = Excellent)</small
              >
            </div>
            <div class="mb-3">
              <label class="form-label">Your Feedback *</label>
              <textarea
                class="form-control"
                id="feedbackText"
                rows="4"
                placeholder="Share your experience with this hawker..."
                required
              ></textarea>
            </div>
            <div class="d-grid">
              <button
                type="submit"
                class="btn btn-danger btn-lg"
                id="submitBtn"
              >
                Submit Feedback
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Recent Feedback -->
      <div class="card">
        <div
          class="card-header bg-danger text-white d-flex justify-content-between align-items-center"
        >
          <h5 class="mb-0">Recent Feedback</h5>
          <div
            class="spinner-border spinner-border-sm text-white d-none"
            id="loadingSpinner"
            role="status"
          >
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>
        <div class="card-body" id="feedbackContainer">
          <!-- Feedback items will be loaded here dynamically -->
          <div class="text-center text-muted py-4">
            <div class="spinner-border" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Loading feedback...</p>
          </div>
        </div>
      </div>
    </div>

    <footer class="bg-dark text-white py-4 mt-5">
      <div class="container text-center">
        <p>&copy; 2024 HawkerHub. All rights reserved.</p>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Firebase SDK -->
    <script type="module">
      // Import Firebase modules
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import {
        getAuth,
        onAuthStateChanged,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
      import {
        getFirestore,
        collection,
        addDoc,
        query,
        orderBy,
        limit,
        getDocs,
        serverTimestamp,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

      // Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyAjnXDGgSpL5fpzyRVfRXNj04RWS-rPdw4",
        authDomain: "feedback-8b979.firebaseapp.com",
        projectId: "feedback-8b979",
        storageBucket: "feedback-8b979.firebasestorage.app",
        messagingSenderId: "167033275651",
        appId: "1:167033275651:web:4d75cca9519fb649e15536",
        measurementId: "G-S51VRLWXDD",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      let currentUser = null;

      // Star rating system
      const stars = document.querySelectorAll(".star");
      const ratingValue = document.getElementById("ratingValue");

      stars.forEach((star) => {
        star.addEventListener("click", function () {
          const value = parseInt(this.getAttribute("data-value"));
          ratingValue.value = value;

          // Update star display
          stars.forEach((s, index) => {
            if (index < value) {
              s.textContent = "★";
              s.style.color = "#ffc107";
            } else {
              s.textContent = "☆";
              s.style.color = "#ccc";
            }
          });
        });

        // Hover effect
        star.addEventListener("mouseover", function () {
          const value = parseInt(this.getAttribute("data-value"));
          stars.forEach((s, index) => {
            if (index < value) {
              s.style.color = "#ffc107";
            }
          });
        });

        star.addEventListener("mouseout", function () {
          const currentRating = parseInt(ratingValue.value);
          stars.forEach((s, index) => {
            if (index >= currentRating) {
              s.style.color = "#ccc";
            }
          });
        });
      });

      // Function to render star rating
      function renderStars(rating) {
        let starsHtml = "";
        for (let i = 1; i <= 5; i++) {
          if (i <= rating) {
            starsHtml += '<i class="bi bi-star-fill"></i>';
          } else if (i - 0.5 <= rating) {
            starsHtml += '<i class="bi bi-star-half"></i>';
          } else {
            starsHtml += '<i class="bi bi-star"></i>';
          }
        }
        return starsHtml;
      }

      // Function to format timestamp
      function formatTimestamp(timestamp) {
        if (!timestamp) return "Just now";

        const now = new Date();
        const feedbackDate = timestamp.toDate();
        const diffMs = now - feedbackDate;
        const diffMins = Math.floor(diffMs / 60000);
        const diffHours = Math.floor(diffMs / 3600000);
        const diffDays = Math.floor(diffMs / 86400000);

        if (diffMins < 1) return "Just now";
        if (diffMins < 60)
          return `${diffMins} minute${diffMins > 1 ? "s" : ""} ago`;
        if (diffHours < 24)
          return `${diffHours} hour${diffHours > 1 ? "s" : ""} ago`;
        if (diffDays < 7)
          return `${diffDays} day${diffDays > 1 ? "s" : ""} ago`;
        if (diffDays < 30) {
          const weeks = Math.floor(diffDays / 7);
          return `${weeks} week${weeks > 1 ? "s" : ""} ago`;
        }
        return feedbackDate.toLocaleDateString();
      }

      // Function to load feedback from Firestore
      async function loadFeedback() {
        const feedbackContainer = document.getElementById("feedbackContainer");

        try {
          const q = query(
            collection(db, "feedbacks"),
            orderBy("timestamp", "desc"),
            limit(10),
          );

          const querySnapshot = await getDocs(q);

          if (querySnapshot.empty) {
            feedbackContainer.innerHTML = `
              <div class="text-center text-muted py-4">
                <i class="bi bi-chat-square-text" style="font-size: 3rem;"></i>
                <p class="mt-2">No feedback yet. Be the first to share your experience!</p>
              </div>
            `;
            return;
          }

          let feedbackHtml = "";

          querySnapshot.forEach((doc) => {
            const data = doc.data();
            feedbackHtml += `
              <div class="feedback-item mb-4 p-3 border rounded">
                <div class="d-flex justify-content-between align-items-start mb-2">
                  <div>
                    <h6 class="mb-1">${data.hawkerName}</h6>
                    <small class="text-muted">By ${data.userName || "Anonymous"} • ${formatTimestamp(data.timestamp)}</small>
                  </div>
                  <div class="text-warning">
                    ${renderStars(data.rating)}
                  </div>
                </div>
                <p class="mb-0">"${data.feedbackText}"</p>
              </div>
            `;
          });

          feedbackContainer.innerHTML = feedbackHtml;
        } catch (error) {
          console.error("Error loading feedback:", error);
          feedbackContainer.innerHTML = `
            <div class="alert alert-danger">
              Error loading feedback. Please try again later.
            </div>
          `;
        }
      }

      // Handle feedback submission
      document
        .getElementById("feedbackForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          if (!currentUser) {
            alert("Please login to submit feedback.");
            window.location.href = "login.html";
            return;
          }

          const hawker = document.getElementById("hawkerSelect").value;
          const rating = parseInt(document.getElementById("ratingValue").value);
          const feedback = document.getElementById("feedbackText").value.trim();

          if (rating === 0) {
            alert("Please provide a rating by clicking the stars");
            return;
          }

          if (!feedback) {
            alert("Please write your feedback");
            return;
          }

          const submitBtn = document.getElementById("submitBtn");
          const originalText = submitBtn.textContent;
          submitBtn.disabled = true;
          submitBtn.innerHTML =
            '<span class="spinner-border spinner-border-sm me-2"></span>Submitting...';

          try {
            // Add feedback to Firestore
            await addDoc(collection(db, "feedbacks"), {
              hawkerName: hawker,
              rating: rating,
              feedbackText: feedback,
              userId: currentUser.uid,
              userEmail: currentUser.email,
              userName:
                currentUser.displayName || currentUser.email.split("@")[0],
              timestamp: serverTimestamp(),
              createdAt: new Date().toISOString(),
            });

            // Show success message
            alert(
              `Thank you for your feedback!\n\nHawker: ${hawker}\nRating: ${rating}/5\n\nYour feedback has been submitted successfully.`,
            );

            // Reset form
            document.getElementById("feedbackForm").reset();
            stars.forEach((star) => {
              star.textContent = "☆";
              star.style.color = "#ccc";
            });
            ratingValue.value = "0";

            // Reload feedback list
            await loadFeedback();
          } catch (error) {
            console.error("Error submitting feedback:", error);
            alert("Error submitting feedback. Please try again.");
          } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = originalText;
          }
        });

      // Check authentication state
      onAuthStateChanged(auth, (user) => {
        currentUser = user;
        const submitBtn = document.getElementById("submitBtn");

        if (!user) {
          submitBtn.textContent = "Login to Submit Feedback";
          submitBtn.onclick = function (e) {
            e.preventDefault();
            alert("Please login to submit feedback.");
            window.location.href = "login.html";
          };
        } else {
          submitBtn.textContent = "Submit Feedback";
          submitBtn.onclick = null; // Remove the custom onclick
        }

        // Load feedback regardless of auth state
        loadFeedback();
      });
    </script>

    <style>
      .rating-stars {
        font-size: 2rem;
        cursor: pointer;
      }
      .star {
        color: #ccc;
        margin-right: 5px;
        transition: color 0.2s;
      }
      .star:hover {
        color: #ffc107;
      }
      .feedback-item {
        transition: box-shadow 0.2s;
      }
      .feedback-item:hover {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
    </style>
  </body>
</html>
// Import the functions you need from the SDKs you need import { initializeApp }
from "firebase/app"; import { getAnalytics } from "firebase/analytics"; // TODO:
Add SDKs for Firebase products that you want to use //
https://firebase.google.com/docs/web/setup#available-libraries // Your web app's
Firebase configuration // For Firebase JS SDK v7.20.0 and later, measurementId
is optional const firebaseConfig = { apiKey:
"AIzaSyAjnXDGgSpL5fpzyRVfRXNj04RWS-rPdw4", authDomain:
"feedback-8b979.firebaseapp.com", projectId: "feedback-8b979", storageBucket:
"feedback-8b979.firebasestorage.app", messagingSenderId: "167033275651", appId:
"1:167033275651:web:4d75cca9519fb649e15536", measurementId: "G-S51VRLWXDD" }; //
Initialize Firebase const app = initializeApp(firebaseConfig); const analytics =
getAnalytics(app);
