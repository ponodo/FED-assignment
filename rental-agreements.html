<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HawkerHub - Rental Agreements</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
    />
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
  

    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
      <div class="container">
        <a class="navbar-brand text-danger fw-bold" href="index.html">
          <i class="bi bi-shop-window me-2"></i>HawkerHub
        </a>
        <div class="d-flex align-items-center">
          <a href="vendor-dashboard.html" class="btn btn-outline-danger me-3">
            <i class="bi bi-arrow-left me-2"></i>Back to Dashboard
          </a>
        </div>
      </div>
    </nav>

    <div class="container mt-5">
      <h1 class="mb-4 text-danger">Rental Agreements</h1>

      <div class="mb-4">
        <a href="create-rental-agreement.html" class="btn btn-danger">
          <i class="bi bi-plus-lg me-2"></i>Create New Agreement
        </a>
      </div>

      <div id="agreementsList">
        <!-- List of agreements will populate here -->
      </div>
    </div>

    <footer class="bg-dark text-white py-4 mt-5">
      <div class="container text-center">
        <p>&copy; 2024 HawkerHub. All rights reserved.</p>
      </div>
    </footer>

    <script type="module">
      // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, query, where } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyBazksxHfRgOJcraIVqslvCWqZT4qjTWZE",
    authDomain: "hawkerhub-b4a7a.firebaseapp.com",
    projectId: "hawkerhub-b4a7a",
    storageBucket: "hawkerhub-b4a7a.firebasestorage.app",
    messagingSenderId: "43569063246",
    appId: "1:43569063246:web:9d18d5107d2081784e2a1f"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

      window.onload = async function() {
        // check vendor login
        const user = JSON.parse(localStorage.getItem("hawkerhub_user"));
        if (!user || user.role !== "vendor") {
          window.location.href = "login.html";
        }

        const agreementsRef = collection(db, "rentalAgreements");
        const q = query(agreementsRef, where("vendorId", "==", user.vendorId));
        const snapshot = await getDocs(q);
        console.log(snapshot);
        const container = document.getElementById("agreementsList");
        if (snapshot.empty) {
          container.innerHTML = '<p>No rental agreements found.</p>';
          return;
        }

        snapshot.forEach(doc => {
          const data = doc.data();
          const html = `
            <div class="card mb-4">
              <div class="card-header bg-danger text-white">
                <h5 class="mb-0">${data.hawkerCenter} - Stall ${data.stallNumber}</h5>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-6">
                    <p><strong>Monthly Rent:</strong> $${data.monthlyRent.toFixed(2)}</p>
                    <p><strong>Stall Size:</strong> ${data.stallSize || "N/A"} sq ft</p>
                  </div>
                  <div class="col-md-6">
                    <p><strong>Agreement Start:</strong> ${data.startDate}</p>
                    <p><strong>Agreement End:</strong> ${data.endDate}</p>
                    <p><strong>Status:</strong> <span class="badge bg-success">${data.status}</span></p>
                  </div>
                </div>
                <div class="mt-3">
                  <a href="stall-management.html?stallId=${data.stallId}" class="btn btn-outline-danger me-2">
                    <i class="bi bi-eye me-2"></i>View Stall
                  </a>
                  <button class="btn btn-outline-danger" onclick="alert('Download PDF functionality not implemented')">
                    <i class="bi bi-download me-2"></i>Download PDF
                  </button>
                </div>
              </div>
            </div>
          `;
          container.innerHTML += html;
        });
      }
    </script>
  </body>
</html>