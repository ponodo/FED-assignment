<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HawkerHub - Checkout</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
    />
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <nav class="navbar navbar-light bg-white shadow-sm">
      <div class="container">
        <a class="navbar-brand text-danger fw-bold" href="index.html">
          <i class="bi bi-shop-window me-2"></i>HawkerHub
        </a>
      </div>
    </nav>

    <div class="container mt-5">
      <h1 class="mb-4 text-danger">Checkout</h1>

      <div class="row">
        <!-- Delivery Details -->
        <div class="col-md-6">
          <div class="card mb-4">
            <div class="card-header bg-danger text-white">
              <h5 class="mb-0">Delivery Details</h5>
            </div>
            <div class="card-body">
              <form id="deliveryForm">
                <div class="mb-3">
                  <label class="form-label">Full Name *</label>
                  <input
                    type="text"
                    class="form-control"
                    id="fullName"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label class="form-label">Phone Number *</label>
                  <input type="tel" class="form-control" id="phone" required />
                </div>
                <div class="mb-3">
                  <label class="form-label">Delivery Address</label>
                  <textarea
                    class="form-control"
                    id="address"
                    rows="3"
                    placeholder="For delivery orders only"
                  ></textarea>
                </div>
                <div class="mb-3">
                  <label class="form-label">Delivery Type</label>
                  <select class="form-select" id="deliveryType">
                    <option value="pickup">Pickup</option>
                    <option value="delivery">Delivery (+$3.00)</option>
                  </select>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- Order & Payment -->
        <div class="col-md-6">
          <div class="card mb-4">
            <div class="card-header bg-danger text-white">
              <h5 class="mb-0">Order Summary</h5>
            </div>
            <div class="card-body">
              <div id="orderItems">
                <!-- Items will load here -->
              </div>
              <div class="mt-3">
                <div class="d-flex justify-content-between mb-2">
                  <span>Subtotal:</span>
                  <span id="orderSubtotal">$0.00</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                  <span>Delivery:</span>
                  <span id="orderDelivery">$0.00</span>
                </div>
                <hr />
                <div class="d-flex justify-content-between">
                  <span class="fw-bold">Total:</span>
                  <span class="fw-bold text-danger" id="orderTotal">$0.00</span>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header bg-danger text-white">
              <h5 class="mb-0">Payment</h5>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <label class="form-label">Payment Method</label>
                <select class="form-select" id="paymentMethod">
                  <option>PayNow</option>
                  <option>Credit/Debit Card</option>
                  <option>Cash on Pickup</option>
                </select>
              </div>

              <div class="form-check mb-3">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="terms"
                  required
                />
                <label class="form-check-label">
                  I agree to the
                  <a href="#" class="text-danger">Terms & Conditions</a>
                </label>
              </div>

              <div class="d-grid">
                <button class="btn btn-danger btn-lg" onclick="placeOrder()">
                  Place Order
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer class="bg-dark text-white py-4 mt-5">
      <div class="container text-center">
        <p>&copy; 2024 HawkerHub. All rights reserved.</p>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // Load order summary
      function loadOrderSummary() {
        const cart = JSON.parse(localStorage.getItem("cart")) || [];
        const orderItems = document.getElementById("orderItems");
        const subtotalEl = document.getElementById("orderSubtotal");
        const deliveryEl = document.getElementById("orderDelivery");
        const totalEl = document.getElementById("orderTotal");

        if (cart.length === 0) {
          orderItems.innerHTML = '<p class="text-muted">No items in cart</p>';
          subtotalEl.textContent = "$0.00";
          deliveryEl.textContent = "$0.00";
          totalEl.textContent = "$0.00";
          return;
        }

        let subtotal = 0;
        let itemsHTML = "<h6>Items:</h6>";

        cart.forEach((item) => {
          const itemTotal = item.price * (item.quantity || 1);
          subtotal += itemTotal;
          itemsHTML += `
                    <div class="d-flex justify-content-between mb-1">
                        <span>${item.name} x${item.quantity || 1}</span>
                        <span>$${itemTotal.toFixed(2)}</span>
                    </div>
                `;
        });

        orderItems.innerHTML = itemsHTML;
        const delivery =
          document.getElementById("deliveryType").value === "delivery"
            ? 3.0
            : 0;
        const total = subtotal + delivery;

        subtotalEl.textContent = `$${subtotal.toFixed(2)}`;
        deliveryEl.textContent = `$${delivery.toFixed(2)}`;
        totalEl.textContent = `$${total.toFixed(2)}`;
      }

      // Update delivery fee when type changes
      document
        .getElementById("deliveryType")
        .addEventListener("change", loadOrderSummary);

      // Place order
      function placeOrder() {
        const cart = JSON.parse(localStorage.getItem("cart")) || [];
        if (cart.length === 0) {
          alert("Your cart is empty!");
          return;
        }

        if (!document.getElementById("terms").checked) {
          alert("Please accept the Terms & Conditions");
          return;
        }

        const fullName = document.getElementById("fullName").value;
        const phone = document.getElementById("phone").value;

        if (!fullName || !phone) {
          alert("Please fill in required delivery details");
          return;
        }

        // Create order
        const order = {
          id: "ORD" + Date.now(),
          date: new Date().toLocaleString(),
          items: cart,
          customer: fullName,
          phone: phone,
          address: document.getElementById("address").value || "Pickup",
          deliveryType: document.getElementById("deliveryType").value,
          paymentMethod: document.getElementById("paymentMethod").value,
          status: "pending",
        };

        // Save order
        const orders = JSON.parse(localStorage.getItem("orders")) || [];
        orders.push(order);
        localStorage.setItem("orders", JSON.stringify(orders));

        // Clear cart
        localStorage.removeItem("cart");

        // Show success
        alert(
          `âœ… Order placed successfully!\nOrder ID: ${order.id}\nThank you for your order!`,
        );

        // Redirect to orders page
        setTimeout(() => {
          window.location.href = "my-orders.html";
        }, 1000);
      }

      // Initialize
      window.onload = function () {
        loadOrderSummary();

        // Check if user is logged in
        const user = JSON.parse(localStorage.getItem("hawkerhub_user"));
        if (user) {
          document.getElementById("fullName").value =
            user.firstName + " " + user.lastName;
          if (user.phone) {
            document.getElementById("phone").value = user.phone;
          }
        }
      };
    </script>
  </body>
</html>
