<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HawkerHub - My Orders</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
    />
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
      <div class="container">
        <a class="navbar-brand text-danger fw-bold" href="index.html">
          <i class="bi bi-shop-window me-2"></i>HawkerHub
        </a>
        <div class="d-flex align-items-center">
          <a href="order.html" class="btn btn-outline-danger me-3">
            <i class="bi bi-basket me-2"></i>Order Food
          </a>
          <a href="customer-dashboard.html" class="btn btn-outline-danger">
            <i class="bi bi-speedometer2 me-2"></i>Dashboard
          </a>
        </div>
      </div>
    </nav>

    <div class="container mt-5">
      <h1 class="mb-4 text-danger">My Orders</h1>

      <!-- Order Filter -->
      <div class="row mb-4">
        <div class="col-md-3">
          <select
            class="form-select"
            id="statusFilter"
            onchange="filterOrders()"
          >
            <option value="all">All Orders</option>
            <option value="pending">Pending</option>
            <option value="preparing">Preparing</option>
            <option value="ready">Ready</option>
            <option value="completed">Completed</option>
          </select>
        </div>
      </div>

      <!-- Orders List -->
      <div id="ordersList">
        <!-- Orders will load here -->
        <div class="text-center py-5">
          <i class="bi bi-receipt display-1 text-muted mb-3"></i>
          <h4>No orders yet</h4>
          <p class="text-muted">
            Start ordering from our delicious hawker stalls!
          </p>
          <a href="order.html" class="btn btn-danger mt-3">Order Now</a>
        </div>
      </div>
    </div>

    <footer class="bg-dark text-white py-4 mt-5">
      <div class="container text-center">
        <p>&copy; 2024 HawkerHub. All rights reserved.</p>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // Load orders
      function loadOrders() {
        const orders = JSON.parse(localStorage.getItem("orders")) || [];
        const ordersList = document.getElementById("ordersList");

        if (orders.length === 0) {
          ordersList.innerHTML = `
                    <div class="text-center py-5">
                        <i class="bi bi-receipt display-1 text-muted mb-3"></i>
                        <h4>No orders yet</h4>
                        <p class="text-muted">Start ordering from our delicious hawker stalls!</p>
                        <a href="order.html" class="btn btn-danger mt-3">Order Now</a>
                    </div>
                `;
          return;
        }

        let ordersHTML = "";

        orders.forEach((order) => {
          const totalItems = order.items.reduce(
            (sum, item) => sum + (item.quantity || 1),
            0,
          );
          const totalAmount = order.items.reduce(
            (sum, item) => sum + item.price * (item.quantity || 1),
            0,
          );
          const deliveryFee = order.deliveryType === "delivery" ? 3.0 : 0;
          const total = totalAmount + deliveryFee;

          // Get status badge color
          let badgeClass = "bg-secondary";
          if (order.status === "pending") badgeClass = "bg-warning";
          else if (order.status === "preparing") badgeClass = "bg-info";
          else if (order.status === "ready") badgeClass = "bg-primary";
          else if (order.status === "completed") badgeClass = "bg-success";

          ordersHTML += `
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col-md-3">
                                    <h6 class="mb-1">Order ${order.id}</h6>
                                    <small class="text-muted">${order.date}</small>
                                </div>
                                <div class="col-md-3">
                                    <p class="mb-1">${totalItems} items</p>
                                    <small class="text-muted">${order.deliveryType}</small>
                                </div>
                                <div class="col-md-2">
                                    <span class="fw-bold text-danger">$${total.toFixed(2)}</span>
                                </div>
                                <div class="col-md-2">
                                    <span class="badge ${badgeClass}">${order.status}</span>
                                </div>
                                <div class="col-md-2 text-end">
                                    <button class="btn btn-sm btn-outline-danger" onclick="viewOrder('${order.id}')">
                                        View Details
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
        });

        ordersList.innerHTML = ordersHTML;
      }

      // Filter orders
      function filterOrders() {
        const filter = document.getElementById("statusFilter").value;
        const orders = JSON.parse(localStorage.getItem("orders")) || [];
        const ordersList = document.getElementById("ordersList");

        if (filter === "all") {
          loadOrders();
          return;
        }

        const filteredOrders = orders.filter(
          (order) => order.status === filter,
        );

        if (filteredOrders.length === 0) {
          ordersList.innerHTML = `
                    <div class="text-center py-5">
                        <i class="bi bi-search display-1 text-muted mb-3"></i>
                        <h4>No ${filter} orders</h4>
                        <p class="text-muted">You don't have any ${filter} orders.</p>
                    </div>
                `;
          return;
        }

        let ordersHTML = "";

        filteredOrders.forEach((order) => {
          const totalItems = order.items.reduce(
            (sum, item) => sum + (item.quantity || 1),
            0,
          );
          const totalAmount = order.items.reduce(
            (sum, item) => sum + item.price * (item.quantity || 1),
            0,
          );
          const deliveryFee = order.deliveryType === "delivery" ? 3.0 : 0;
          const total = totalAmount + deliveryFee;

          ordersHTML += `
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col-md-3">
                                    <h6 class="mb-1">Order ${order.id}</h6>
                                    <small class="text-muted">${order.date}</small>
                                </div>
                                <div class="col-md-3">
                                    <p class="mb-1">${totalItems} items</p>
                                    <small class="text-muted">${order.deliveryType}</small>
                                </div>
                                <div class="col-md-2">
                                    <span class="fw-bold text-danger">$${total.toFixed(2)}</span>
                                </div>
                                <div class="col-md-2">
                                    <span class="badge bg-warning">${order.status}</span>
                                </div>
                                <div class="col-md-2 text-end">
                                    <button class="btn btn-sm btn-outline-danger" onclick="viewOrder('${order.id}')">
                                        View Details
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
        });

        ordersList.innerHTML = ordersHTML;
      }

      // View order details
      function viewOrder(orderId) {
        const orders = JSON.parse(localStorage.getItem("orders")) || [];
        const order = orders.find((o) => o.id === orderId);

        if (order) {
          let details = `Order Details:\n\n`;
          details += `Order ID: ${order.id}\n`;
          details += `Date: ${order.date}\n`;
          details += `Customer: ${order.customer}\n`;
          details += `Phone: ${order.phone}\n`;
          details += `Delivery: ${order.deliveryType}\n`;
          details += `Address: ${order.address || "Pickup"}\n`;
          details += `Payment: ${order.paymentMethod}\n`;
          details += `Status: ${order.status}\n\n`;
          details += `Items:\n`;

          order.items.forEach((item) => {
            details += `- ${item.name} x${item.quantity || 1}: $${(item.price * (item.quantity || 1)).toFixed(2)}\n`;
          });

          const totalAmount = order.items.reduce(
            (sum, item) => sum + item.price * (item.quantity || 1),
            0,
          );
          const deliveryFee = order.deliveryType === "delivery" ? 3.0 : 0;
          const total = totalAmount + deliveryFee;

          details += `\nSubtotal: $${totalAmount.toFixed(2)}\n`;
          details += `Delivery: $${deliveryFee.toFixed(2)}\n`;
          details += `Total: $${total.toFixed(2)}`;

          alert(details);
        }
      }

      // Initialize
      window.onload = function () {
        loadOrders();
      };
    </script>
  </body>
</html>
