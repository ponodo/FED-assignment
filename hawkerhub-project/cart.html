<!doctype html>
<html lang="en">
  <head>
    <!-- Page settings -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HawkerHub - Shopping Cart</title>

    <!-- Bootstrap CSS (layout + styling) -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
    />

    <!-- Your custom CSS (optional) -->
    <link rel="stylesheet" href="css/style.css" />
  </head>

  <body>
    <!-- =========================
         NAVBAR
         ========================= -->
    <nav class="navbar navbar-light bg-white shadow-sm">
      <div class="container">
        <!-- Brand -->
        <a class="navbar-brand text-danger fw-bold" href="index.html">
          <i class="bi bi-shop-window me-2"></i>HawkerHub
        </a>

        <!-- Back to order page -->
        <a href="order.html" class="btn btn-outline-danger">
          <i class="bi bi-arrow-left me-2"></i>Continue Shopping
        </a>
      </div>
    </nav>

    <!-- =========================
         MAIN CONTENT
         ========================= -->
    <div class="container mt-5">
      <h1 class="mb-4 text-danger">Shopping Cart</h1>

      <div class="row">
        <!-- =========================
             LEFT: CART ITEMS AREA
             ========================= -->
        <div class="col-md-8">
          <div class="card cart-box">
            <div class="card-body">
              <!-- JS will render items into this container -->
              <div id="cartList" class="cart-list">
                <!-- Default placeholder (will be replaced by JS if cart has items) -->
                <div class="text-center py-5">
                  <i class="bi bi-cart display-1 text-muted mb-3"></i>
                  <h4>Your cart is empty</h4>
                  <p class="text-muted">Add some delicious food from our hawkers!</p>
                  <a href="order.html" class="btn btn-danger mt-3">Browse Food</a>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- =========================
             RIGHT: ORDER SUMMARY
             ========================= -->
        <div class="col-md-4">
          <div class="card summary-box">
            <div class="card-header bg-danger text-white">
              <h5 class="mb-0">Order Summary</h5>
            </div>

            <div class="card-body">
              <!-- Subtotal line -->
              <div class="d-flex justify-content-between mb-2">
                <span>Subtotal:</span>
                <span id="subtotal" class="line-subtotal">$0.00</span>
              </div>

              <!-- Delivery fee line (fixed fee for now) -->
              <div class="d-flex justify-content-between mb-2">
                <span>Delivery Fee:</span>
                <span id="delivery" class="line-delivery">$3.00</span>
              </div>

              <hr />

              <!-- Total line -->
              <div class="d-flex justify-content-between mb-4">
                <span class="fw-bold">Total:</span>
                <span class="fw-bold text-danger" id="total" class="line-total">$3.00</span>
              </div>

              <!-- Buttons -->
              <div class="d-grid gap-2">
                <a href="checkout.html" class="btn btn-danger btn-lg">Proceed to Checkout</a>
                <a href="order.html" class="btn btn-outline-danger">Continue Shopping</a>
              </div>

              <!-- Info text -->
              <div class="mt-4">
                <p class="small text-muted">
                  <i class="bi bi-info-circle me-1"></i>
                  Free delivery for orders above $20
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- =========================
         FOOTER
         ========================= -->
    <footer class="bg-dark text-white py-4 mt-5">
      <div class="container text-center">
        <p>&copy; 2024 HawkerHub. All rights reserved.</p>
      </div>
    </footer>

    <!-- Bootstrap JS (some Bootstrap components need it) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      /* =========================================================
         CART PAGE LOGIC (Local Storage)
         =========================================================
         - Cart is stored in localStorage under key "cart"
         - localStorage only stores strings
         - So we JSON.stringify() when saving, and JSON.parse() when reading
      */

      // Fixed delivery fee for now
      const DELIVERY_FEE = 3.0;

      // Grab important HTML elements once
      const cartListEl = document.getElementById("cartList");
      const subtotalEl = document.getElementById("subtotal");
      const totalEl = document.getElementById("total");

      /* -------------------------
         Helper: read cart from localStorage
         Returns an array of items
         Example item: { name: "Laksa", price: 6.0, quantity: 2 }
      -------------------------- */
      function getCart() {
        return JSON.parse(localStorage.getItem("cart")) || [];
      }

      /* -------------------------
         Helper: save cart back to localStorage
      -------------------------- */
      function saveCart(cart) {
        localStorage.setItem("cart", JSON.stringify(cart));
      }

      /* -------------------------
         1) Render the cart page UI
         - If cart is empty -> show empty message
         - If cart has items -> show item rows and calculate totals
      -------------------------- */
      function renderCart() {
        const cart = getCart();

        // Case 1: cart empty
        if (cart.length === 0) {
          cartListEl.innerHTML = `
            <div class="text-center py-5">
              <i class="bi bi-cart display-1 text-muted mb-3"></i>
              <h4>Your cart is empty</h4>
              <p class="text-muted">Add some delicious food from our hawkers!</p>
              <a href="order.html" class="btn btn-danger mt-3">Browse Food</a>
            </div>
          `;
          subtotalEl.textContent = "$0.00";
          totalEl.textContent = `$${DELIVERY_FEE.toFixed(2)}`;
          return; // stop here
        }

        // Case 2: cart has items
        let subtotal = 0;
        let html = "";

        // Build HTML for each cart item
        cart.forEach((item, index) => {
          // Default quantity to 1 if missing
          const qty = item.quantity || 1;

          // Item total = price * qty
          const itemTotal = item.price * qty;
          subtotal += itemTotal;

          html += `
            <div class="item-row d-flex justify-content-between align-items-center border-bottom pb-3 mb-3">
              <!-- Left: item name + price -->
              <div>
                <h6 class="mb-1">${item.name}</h6>
                <p class="mb-0 text-muted">$${item.price.toFixed(2)} each</p>
              </div>

              <!-- Right: quantity controls + item total + delete button -->
              <div class="d-flex align-items-center">
                <!-- Quantity control -->
                <div class="input-group input-group-sm qty-box" style="width: 110px;">
                  <button class="btn btn-outline-secondary" onclick="changeQty(${index}, -1)">-</button>
                  <input type="text" class="form-control text-center" value="${qty}" readonly>
                  <button class="btn btn-outline-secondary" onclick="changeQty(${index}, 1)">+</button>
                </div>

                <!-- Item total -->
                <span class="ms-3 fw-bold">$${itemTotal.toFixed(2)}</span>

                <!-- Remove button -->
                <button class="btn btn-link text-danger ms-3" onclick="removeItem(${index})">
                  <i class="bi bi-trash"></i>
                </button>
              </div>
            </div>
          `;
        });

        // Put the generated HTML on screen
        cartListEl.innerHTML = html;

        // Compute final total
        const total = subtotal + DELIVERY_FEE;

        // Update summary numbers on the right
        subtotalEl.textContent = `$${subtotal.toFixed(2)}`;
        totalEl.textContent = `$${total.toFixed(2)}`;
      }

      /* -------------------------
         2) Change quantity
         - index = which item in cart array
         - delta = +1 or -1
         - If quantity becomes 0 -> remove item
      -------------------------- */
      function changeQty(index, delta) {
        const cart = getCart();

        // Safety check (if index is invalid, do nothing)
        if (!cart[index]) return;

        const currentQty = cart[index].quantity || 1;
        const newQty = currentQty + delta;

        // If new quantity < 1, remove the item completely
        if (newQty < 1) {
          cart.splice(index, 1);
        } else {
          cart[index].quantity = newQty;
        }

        // Save changes and re-render
        saveCart(cart);
        renderCart();
      }

      /* -------------------------
         3) Remove item (trash icon)
      -------------------------- */
      function removeItem(index) {
        const cart = getCart();

        // Remove exactly 1 item at position index
        cart.splice(index, 1);

        // Save and re-render
        saveCart(cart);
        renderCart();
      }

      /* -------------------------
         4) Page load
         When the page loads, draw the cart once.
      -------------------------- */
      window.addEventListener("load", () => {
        renderCart();
      });
    </script>
  </body>
</html>
